{php include wl_template('common/header');}
<script type='text/javascript' src="{$_W['siteroot']}web/resource/components/scrollLoading/jquery-ui-1.10.3.min.js" charset='utf-8'></script>
<ul class="nav nav-tabs" id="myTab">
	<li class="active" ><a href="#tab_basic">基本信息</a></li>
	<li><a href="#tab_detail">简介详情</a></li>
	<li><a href="#tab_share">分享设置</a></li>
	<li><a href="#tag_name">自定义标签属性</a></li>
</ul>
<div class="main">
	<form action="" method="post" class="form-horizontal form" id="form">
		<div class="tab-content">
			<div class="tab-pane  active" id="tab_basic">
				<div class="panel panel-default">
					<div class="panel-heading">商品信息</div>
						<div class="panel-body">
						<div class="panel-body">
							
							<div class="form-group">
					            <label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">选择商家</label>
					            <div class="col-md-6">
					                <div class='input-group'>
					                    <div class="input-group ">
					                        <input type="text" class="form-control col-md-6" id="name" name="" value="{$merchant['storename']}" style="width: 460px;">
					                        <span class="input-group-btn">
					                            <button class="btn btn-default" type="button" onclick="popwin = $('#modal-module-goodshouse').modal();">选择商家</button></span>
					                    </div>
					                    <div class="input-group " style="margin-top:.5em;">
					                        <input type="hidden" value="$merchant['id']" name="goods[sid]" id="sid">
					                        <img src="{if empty($merchant['logo'])}../web/resource/images/nopic.jpg{else}{php echo tomedia($merchant['logo'])}{/if}" class="img-responsive img-thumbnail" width="150" id="img" />
					                        <em class="close" style="position:absolute; top: 0px; right: -14px;" title="删除" onclick="remove_goodshouse(this)">×</em></div>
					                </div>
					            </div>
					        </div>
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">商品编码</label>
								<div class="col-md-6">
									<input type="text" name="goods[code]" class="form-control" value="{$goods['code']}" id="goodscode" />
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">商品名称</label>
								<div class="col-md-6">
									<input type="text" name="goods[name]" id="name" class="form-control" value="{$goods['name']}" />
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">单位</label>
								<div class="col-md-6">
									<input type="text" name="goods[unit]" class="form-control" value="{$goods['unit']}" />
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">抢购价</label>
								<div class="col-md-4">
								<div class="input-group">
									<span class="input-group-addon">￥</span>
									<input type="text" name="goods[price]" class="form-control" value="{$goods['price']}" />
								</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">VIP价</label>
								<div class="col-md-4">
								<div class="input-group">
									<span class="input-group-addon">￥</span>
									<input type="text" name="goods[vipprice]" class="form-control" value="{$goods['vipprice']}" />
								</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">原价</label>
								<div class="col-md-4">
								<div class="input-group">
									<span class="input-group-addon">￥</span>
									<input type="text" name="goods[oldprice]" class="form-control" value="{$goods['oldprice']}"  id="price"/>
								</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">首页图片</label>
								<div class="col-md-6">
									{php echo tpl_form_field_image('goods[thumb]', $goods['thumb']);}
									<span class="help-block">图片建议为640X300</span>
								</div>
							</div>
						    <div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">商品图集</label>
						        <div class="col-sm-6">
						           {php echo tpl_form_field_multi_image('goods[thumbs]',$goods['thumbs']);}
						            <span class="help-block">商品详情幻灯片，建议640X300</span>
						        </div>
						    </div>
						</div>
					</div>
				</div>
			</div>
			<div class="tab-pane" id="tab_detail">
				<div class="panel panel-default">
					<div class="panel-heading">简介详情</div>
					<div class="panel-body">
						<div class="panel-body">
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 control-label">商品简介</label>
								<div class="col-sm-9 col-xs-12">
									<textarea name="goods[describe]" class="form-control" cols="70">{$goods['describe']}</textarea>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 control-label">商品详情</label>
								<div class="col-sm-9 col-xs-12">
									{php echo tpl_ueditor('goods[detail]', $goods['detail']);}
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			
<div class="tab-pane" id="tag_name">
	<div class="panel panel-default">
			<div class="panel-heading">自定义商品标签</div>
				<div class="panel-body">
					<div class="panel-body">
					<div class="form-group">


	<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">自定义商品标签</label>
	<div class="col-md-12">
		<div id="datas" class="sms-template-1" style="display:block;">
		        {if !empty($goods['tag'])}
                    {loop $goods['tag'] $data}
                    	{php include wl_template('goodshouse/imgandtag');}
                    {/loop}
                {/if}
		    </div>
		    <div class="form-group sms-template-1" style="display:block;">
		        <label class="col-sm-2 control-label"></label>
		        <div class="col-sm-8 col-xs-12">
		            <a class="btn btn-default btn-add-type" href="javascript:;" onclick="addType();">
		                <i class="fa fa-plus" title=""></i>增加一条标签</a>
		        </div>
		    </div>
	</div>
</div>
						</div>
					</div>
				</div>
			</div>
			
			
			<div class="tab-pane" id="tab_share">
				<div class="panel panel-default">
					<div class="panel-heading">分享设置</div>
					<div class="panel-body">
						<div class="panel-body">
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">分享图片</label>
								<div class="col-xs-12 col-sm-8">
									{php echo tpl_form_field_image('goods[share_image]', $goods['share_image']);}
									<span class="help-block">图片建议为正方形，如果不选择，默认为商品缩略图片</span>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">分享标题</label>
								<div class="col-xs-12 col-sm-8">
									<input type="text" name="goods[share_title]" class="form-control" value="{$goods['share_title']}" />
									<span class="help-block">如果不填写，默认为商品名称</span>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">分享描述</label>
								<div class="col-xs-12 col-sm-8">
									<input type="text" name="goods[share_desc]" class="form-control" value="{$goods['share_desc']}" />
									<span class="help-block">如果不填写，默认为分享描述</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		


		
		
		<div class="form-group col-sm-12">
			<input type="hidden" name="id" value="{$goods['id']}" id="id"/>
			<input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1" />
			<input type="hidden" name="token" value="{$_W['token']}" />
		</div>
	</form>
</div>
<div id="modal-module-goodshouse" class="modal fade" tabindex="-1">
			<div class="modal-dialog" style='width: 920px;'>
				<div class="modal-content">
					<div class="modal-header">
						<button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
						<h3>选取</h3></div>
					<div class="modal-body">
						<div class="row">
							<div class="input-group">
								<input type="text" class="form-control" name="keyword" value="" id="search-kwd-goodshouse" placeholder="请输入商家名称，不输入任何内容搜索结果为所有商家。" />
								<span class='input-group-btn'><button type="button" class="btn btn-default" onclick="search_goodshouse();">搜索</button></span>
							</div>
						</div>
						<div id="module-goodshouse" style="padding-top:5px;"></div>
					</div>
					<div class="modal-footer"><a href="#" class="btn btn-default" data-dismiss="modal" aria-hidden="true">关闭</a></div>
				</div>

			</div>
		</div>
<script type="text/javascript">
	$('#form').submit(function() {
 	 var data = $(this).serialize();
 	 var url =  "{php echo web_url('rush/goodshouse/createGoods')}";
 	 	if($('#id').val()) url =  "{php echo web_url('rush/goodshouse/editGoods')}";
 	 $.ajax({
        type: "POST",
        url:url,
        data:data,
        dataType:'json',
        success: function(data) {
        	layer.msg(data.message);
        	location.href = "{php echo web_url('rush/goodshouse/goodsList')}";
        }
    });
  	return false;
});
</script>
<script>
	$(function () {
		window.optionchanged = false;
		$('#myTab a').click(function (e) {
			e.preventDefault();//阻止a链接的跳转行为
			$(this).tab('show');//显示当前选中的链接及关联的content
		});
	});
	
	$('#goodscode').blur(function(){
	var goodscode = $('#goodscode').val();
	var postid = "{$id}";
	var sign=0;
	$.post("{php echo web_url('goods/goods/goodscode')}",{goodscode:goodscode,postid:postid},function(d){
		if(d.errno){
			util.message('商品码已存在.');
			return false;
		}
	},"json");
});

var kw = 1;
	function addType() {
    $(".btn-add-type").button("loading");
    $.ajax({
        url: "{php echo web_url('rush/goodshouse/tag')}&kw="+kw,
        cache: false
    }).done(function (html) {
        $(".btn-add-type").button("reset");
        $("#datas").append(html);
    });
    kw++;
}		
</script>
<script type="text/javascript">
	$(document).on('click', '.data-item-delete', function () {
        $(this).closest('.data-item').remove();
    });
	})	
</script>
<script language='javascript'>
	function search_goodshouse() {
			$("#module-goodshouse").html("正在搜索....")
			$.get("{php echo web_url('rush/goodshouse/selectMerchant')}", {
				keyword: $.trim($('#search-kwd-goodshouse').val())
			}, function(dat){
				$('#module-goodshouse').html(dat);
			});
		}
	function remove_goodshouse(obj){
        $('#goodsid').val('');
        $('#name').val('');
        $('#img').attr("src",'');
       }
	function select_goodshouse(o) {
        $('#sid').val(o.id);
        $('#name').val(o.storename);
        $('#img').attr("src",o.logo);
	    $('#modal-module-goodshouse').modal('hide');
	    util.tips("操作成功");
 	}
</script>
{php include wl_template('common/footer');}