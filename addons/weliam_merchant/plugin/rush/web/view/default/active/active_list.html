{php include wl_template('common/header');}
<ul class="nav nav-tabs">
	<li {if empty($_GPC['status'])}class="active"{/if}><a href="{php echo web_url('rush/active/activelist');}">全部抢购<span class="label label-warning pull-right" style="margin-left: 10px;">{$status0}</span></a></li>
	<li {if $_GPC['status']==1}class="active"{/if}><a href="{php echo web_url('rush/active/activelist',array('status'=>1));}">待开始<span class="label label-warning pull-right" style="margin-left: 10px;">{$status1}</span></a></li>
	<li {if $_GPC['status']==2}class="active"{/if}><a href="{php echo web_url('rush/active/activelist',array('status'=>2));}">进行中<span class="label label-warning pull-right" style="margin-left: 10px;">{$status2}</span></a></li>
	<li {if $_GPC['status']==3}class="active"{/if}><a href="{php echo web_url('rush/active/activelist',array('status'=>3));}">已结束<span class="label label-warning pull-right" style="margin-left: 10px;">{$status3}</span></a></li>
</ul>
<style type='text/css'>
    .trbody td {text-align: center; vertical-align:top;border-left:1px solid #ccc; border-bottom: 1px solid #ddd;}
	.order-rank img{width:16px; height:16px;}
	.js-remark,.js-admin-remark{word-break:break-all; overflow:hidden; background: #FDEEEE;color: #ED5050;padding: 5px 10px;}
	td.goods-info{position:relative; padding-left:60px;}
	.goods-info .img{position:absolute;top:50%; margin-top:-25px; background: url({IMAGE_LOADING}) center center no-repeat; width:50px;height:50px; }
	.goods-info span {white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: block;}
	.status-text{cursor:pointer;}
	.table>thead>tr>th, .table>tbody>tr>th, .table>tfoot>tr>th, .table>thead>tr>td, .table>tbody>tr>td, .table>tfoot>tr>td {border-top: 1px solid rgba(221, 221, 221, 0);}
	.col-md-1{padding-right: 0px;}
</style>
<div class="panel">
    <div class="panel-body">
        <form action="" method="get" class="form-horizontal" role="form" id="form1">
            <input type="hidden" name="c" value="site" />
            <input type="hidden" name="a" value="entry" />
            <input type="hidden" name="m" value="weliam_merchant" />
            <input type="hidden" name="p" value="rush" />
			<input type="hidden" name="ac" value="active" />
			<input type="hidden" name="do" value="activelist" />
            <div class="form-group">
                <div class="col-md-2">
                    <select name="keywordtype" class="form-control">
                    	<option value="">关键字类型</option>
                        <option value="1" {if $_GPC['keywordtype']==1}selected="selected"{/if}>活动商品名称</option>
                        <option value="2" {if $_GPC['keywordtype']==2}selected="selected"{/if}>活动商品ID</option>
                        <option value="3" {if $_GPC['keywordtype']==3}selected="selected"{/if}>商家名称</option>
                    </select>
                </div>
                <div class="col-md-6 pull-right">
					<div class="input-group">
						<input type="text" name="keyword" class="form-control" value="{$_GPC['keyword']}"  placeholder="请输入关键字"/>
						<span class="input-group-addon" id="search">搜索</span>
					</div>
				</div>
			</div>
        </form>
    </div>
</div>
<script type="text/javascript">
	$("#search").click(function(){
		$('#form1')[0].submit();
	});
</script>
<div class="order-list">
	<div class="panel-body table-responsive collapse in" id="order-template-item-4" style="padding: 0;">
		<table class="table table-bordered">
			<thead style="background-color: #FFFFFF;">
				<tr>
					<th style="width:30px;" class="text-center"><input type="checkbox" onclick="var ck = this.checked;$(':checkbox').each(function(){this.checked = ck});" /></th>
					<th style="width:30px">ID</th>
					<th style="width:180px;">商品</th>
					<th style="width:150px; text-align:center;">所属商家</th>
					<th style="width:80px; text-align:center;">抢购价/VIP价</th>
					<th style="width:80px; text-align:center;">剩余/数量</th>
					<th style="width:220px; text-align:center;">活动时间</th>
					<th style="width:100px; text-align:center;">活动状态</th>
				</tr>
			</thead>
			
		</table>
	</div>
	{loop $activity $item}
	<div class="panel panel-default">
		<div class="panel-heading clearfix" style="padding: 10px 15px;">
			<div class="pull-right">
				<span class="text-muted"></span>&nbsp;&nbsp;
				<a href="{php echo web_url('rush/order/orderlist', array('activeid' => $item['id']))}">查看订单</a> -
				<a href="{php echo web_url('rush/active/createactive', array('id' => $item['id']))}">编辑</a> -
				<a href="javascript:;" class="js-remove" order-id="{$item['id']}" >删除</a>
			</div>
		</div>
		<div class="panel-body table-responsive" style="padding: 0px;">
			<table class="table table-bordered">
				<tbody >
					<tr>
						<td class="text-center" style="width:30px;">
							<center><input type="checkbox" name="checkbox[]" class="checkbox" value="{$item['id']}" /></center>
						</td>
						<td style="width: 30px;" ><center>{$item['id']}</center></td>
						<td class="goods-info line-feed" style="width:180px;padding-left: 10px;">
							<div class="img"><img width="50" height="50" class="oscrollLoading" src="{IMAGE_PIXEL}" data-url="{php echo tomedia($item['thumb'])}" height="50" width="50" onerror="this.src='{IMAGE_NOPIC_SMALL}'" ></div>
							<div class="title" style="padding-left: 60px;">
								<span>{$item['name']}</span>
							</div>
						</td>
						<td class="text-center" style="width:150px;">
							{$item['storename']}
						</td>
						<td class="text-center" style="width:80px;">
							<p>{$item['price']}</p>
							<p>{$item['vipprice']}</p>
						</td>
						<td class="text-center" style="width:80px;">{$item['levelnum']}/{$item['num']}</td>
						<td class="line-feed" style="width:220px;padding-left: 10px;">
							<div class="title" style="padding-left: 30px;">
								<span>开始时间：{php echo date('Y-m-d H:i:s',$item['starttime'])}</span><br />
								<span>结束时间：{php echo date('Y-m-d H:i:s',$item['endtime'])}</span>
							</div>
						</td>
						<td class="text-center" style="width:100px;">
							{if $item['status'] == 1 }<span class="label label-warning">未开始</span>{/if}
							{if $item['status'] == 2 }<span class="label label-success">进行中</span>{/if}
							{if $item['status'] == 3 }<span class="label label-danger">已结束</span>{/if}
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	{/loop}
	{$pager}
	<div id="de1" style="margin-top: 15px;">
		<a href="javascript:;" class="btn btn-default min-width js-batch js-delete">删除选中活动</a>
	</div>
</div>
<script type="text/javascript">
	require(['jquery', 'util'], function($, util){
		$('.js-copy').each(function(){
			var id=$(this).attr('data-id');
			util.clip($("#js-copy"+id), $(this).attr('data-url'));
		});
	});
</script>
<script type="text/javascript">
$(function(){
	$('[name="rank_all"]').click(function() {
		var checked = this.checked;
		$('.js-rank').find('input:checkbox').each(function() {
			this.checked = checked;
		});
	});
	
	$(".oscrollLoading").scrollLoading();
	var $pop = null;
	$('.goods-info').hover(function() {
		var obj = this;
		var img = $(this).find('img').attr('src');
		var $pop = util.popover(obj, function($popover, obj) {
			obj.$popover = $popover;
		}, '<div><img src="'+ img+'" style="max-width:200px; max-height:200px;"></div>');
	}, function() {
		this.$popover.remove();
	});

	//删除
	$('.order-list').delegate('.js-remove', 'click', function(e){
		e.stopPropagation();
		var $this = $(this);
		var id = $this.attr('order-id');
		util.nailConfirm(this, function(state) {
			if(!state) return;
			$.post("{php echo web_url('rush/active/delete')}", { id : id }, function(data){
				if(!data.errno){
					$this.parent().parent().parent().remove();
					util.tips("删除成功！");
				};
			}, 'json');
		}, {html: '确认删除?'});
	});
	
	$('#de1').delegate('.js-delete','click',function(e){
		e.stopPropagation();
		var order_ids = [];
		var $checks=$('.checkbox:checkbox:checked');
		$checks.each(function() {
			if (this.checked) {
				order_ids.push(this.value);
			};
		});
		var $this = $(this);
		var ids = order_ids;
		util.nailConfirm(this, function(state) {
		if(!state) return;
			$.post("{php echo web_url('rush/active/delete')}", { id : ids }, function(data){
				if(!data.errno){
					util.tips("删除成功！");
					location.reload();
				};
			}, 'json');
		}, {html: '确认删除?'});
	});
});
</script>
{php include wl_template('common/footer');}