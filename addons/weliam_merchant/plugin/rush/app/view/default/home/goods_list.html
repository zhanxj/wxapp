{php include wl_template('common/header');}
<style>
.buttons-row .button.active {background-color: #ff512f!important;}
.button {border: 1px solid #ff512f;}
.buttons-row .button {border-color: #ff512f!important;color: #ff512f!important;}
.buttons-row .button.active {color: #fff!important;}
.align-center{width: 90%;margin: 0 auto;}
.loading_more{width:100%;text-align:center;padding:100px 0 15px;font-size:14px;color:#9b9b9b}
.loading{display:inline-block}
.icon_load{display:inline-block;width:29px;height:29px;text-align:center;vertical-align:middle;background:url(../images/list/ico_loading.png);background-repeat:no-repeat;background-size:contain;margin-right:10px}
.icon_load{-webkit-transform:rotate(0deg) translateZ(0);-webkit-transition-duration:0ms;-webkit-animation-name:ico_loading;-webkit-animation-duration:1.5s;-webkit-animation-iteration-count:infinite;-webkit-animation-timing-function:linear}
@-webkit-keyframes ico_loading{from{-webkit-transform:rotate(0deg) translateZ(0)}
to{-webkit-transform:rotate(360deg) translateZ(0)}}.error{display:none;text-align:center}
.noData{display:none;padding-top:10px;text-align:center}
.wz-quan-list{width:100%}
.wz-quan-list ul li{width:100%;margin-bottom:.5rem}
.wz-quan-list ul li a{display:block}
.wz-quan-list ul li a .pic{width:100%;height:8rem;position:relative}
.wz-quan-list ul li a .pic img{display:block;width:100%;height:8rem}
.wz-quan-list ul li a .pic .image-loader-container{width:100%;height:8rem;top:0;left:0;position:absolute;background-color:#e5e5e5;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-content:stretch;-ms-flex-line-pack:stretch;align-content:stretch;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center}
.wz-quan-list ul li a .pic .only-time{position:absolute;right:0;bottom:0;height:1.25rem;line-height:1.25rem;color:#fff;font-size:.6rem;background:rgba(0,0,0,.6);border-radius:.5rem 0 0;padding:0 .5rem 0 .75rem}
.wz-quan-list ul li a .pic .only-time span{margin-left:.25rem}
.wz-quan-list ul li a .info{border:1px solid #eee;border-top:none;background-color:#fff;padding:.6rem}
.wz-quan-list ul li a .info .info-l{float:left;width:68%}
.wz-quan-list ul li a .info .info-l .titlee{height:.9rem;line-height:.9rem;font-size:.75rem;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;margin-bottom:.25rem;color: #333;}
.wz-quan-list ul li a .info .info-l .price .vip-price i{float:left;background:url(icon/vip_bg.png) no-repeat;background-size:100% auto}
.wz-quan-list ul li a .info .info-l .price .vip-price em{background-color:#fb8438}
.wz-quan-list ul li a .info .info-r{float:right;width:30%;margin-top:.25rem}
.wz-quan-list ul li a .info .info-r .buy-btn,.wz-quan-list ul li a .info .info-r .end-btn{display:block;width:100%;height:1.7rem;line-height:1.7rem;font-size:.8rem}
.wz-quan-list ul li a .info .info-l .price .old-price{text-decoration:line-through}
.g-btn-gray,.g-btn-green,.g-btn-org{display:block;background-color:#ff512f;border-radius:.125rem;color:#f5f5f5;text-align:center;border:none}
.g-btn-gray{background-color:#bbb}
.g-btn-green{background-color:#6bce57}
.price{height:1rem}
.price .now-price{font-size:1rem;color:#ff512f}
.price .now-price em{font-size:.75rem}
.price .old-price{font-size:.6rem;color:#999}
</style>
<div class="page-group" >
    <div class="page page-current" id="page-goods-list" >
    	{php include wl_template('common/rightnav');}
		<div class="content infinite-scroll">
			{if $config['content']}
			<div class="swiper-container" id="indexadv">
			    <div class="swiper-wrapper">
			        {loop $config['content'] $adv}
			    	<div {if !empty($adv['data_url'])}onclick="document.location = '{$adv['data_url']}'"{/if} class="swiper-slide" style="min-height: 100px;font-size: 0;">
			    		<img src="{php echo tomedia($adv['data_img'])}">
			    	</div>
			    	{/loop}
			    </div>
			    <div class="swiper-pagination"></div>
			</div>
			<style>
			.swiper-container img {max-width: 100%;max-height: 100%;}
			</style>
			<script>
			var swiper = new Swiper('#indexadv', {
				speed:500,
			    autoplay: 3000,
			    autoplayDisableOnInteraction : false,
			    setWrapperSize:true,
			    pagination: '.swiper-pagination',
			    paginationClickable: true
			});
			</script>
			{/if}
			<div class="buttons-tab" >
		      <a href="{php echo app_url('rush/home/index',array('status'=>2))}" class="{if $status==2}active{/if} button">进行中</a>
		      <a href="{php echo app_url('rush/home/index',array('status'=>1))}" class="{if $status==1}active{/if} button">预告</a>
		      <a href="{php echo app_url('rush/home/index',array('status'=>3))}" class="{if $status==3}active{/if} button">往期</a>
		    </div>
            <div class="wz-quan-list">
			    <ul class="ul_1" style="padding-top: .5rem;">
			    </ul>
			</div>
            <div class="loading_more" style="padding-top: 15px;display: none;"><span class="loading"><i class="icon_load"></i>加载中......</span></div>
	        <div class="error">加载失败，点击重新加载</div>
	        <div class="noData">全部数据加载完毕</div>
		</div>
    </div>
</div>

<script type="text/html" id="goodslist">
{{# for(var i = 0, len = d.length; i < len; i++){ }}
<li style="padding:0 .6rem">
    <a href="{{d[i].a}}">
        <div class="pic">
            <img src="{{d[i].thumb}}">
            {{# if(d[i].status == 2){ }}
            <p class="only-time" id="timer{{ d[i].id }}" sytime="{{ d[i].sytime }}" ></p>
            {{# }else if(d[i].status == 1){ }}
            <p class="only-time" id="timer{{ d[i].id }}" sytime="{{ d[i].sytime }}" >开始时间：{{ d[i].starttime }}</p>
            {{# }else{ }}
            <p class="only-time" id="timer{{ d[i].id }}" sytime="{{ d[i].sytime }}" >抢购已结束</p>
            {{# } }}
        </div>
        <div class="info clearfix">
            <div class="info-l">
                <p class="titlee">
                    {{d[i].name}}
                </p>
                <p class="price">
                    <span class="now-price">
                        ¥{{d[i].price}}
                    </span>
                    <span class="old-price">¥{{d[i].oldprice}}</span>
                </p>
            </div>
            <div class="info-r">
            	{{# if(d[i].status == 2){ }}
                <span class="g-btn-org buy-btn">立即抢购</span>
                {{# }else if(d[i].status == 1){ }}
                <span class="g-btn-green buy-btn" id="gzqiang" qgid="{{d[i].id}}">{{d[i].follow}}</span>
                {{# }else{ }}
                <span class="g-btn-gray end-btn">已抢完</span>
                {{# } }}
            </div>
        </div>
    </a>
</li>
{{# } }}
</script>
<script>
	$(function() {
		'use strict';
		//商品列表页
		$(document).on("pageInit", "#page-goods-list", function(e, id, page) {
			var loading = false;
			var pindex = 1;
			var psize = 10;
			function addItems(pindex, psize) {
				var ajaxurl = "{php echo app_url('rush/home/getGoods',array('status'=>$status))}" + "&pindex=" + pindex + "&psize=" + psize;
				$.ajax({
					type: "POST",
					url: ajaxurl,
					dataType: 'json',
					beforeSend: function(XMLHttpRequest) {},
					success: function(data) {
						if (data.length > 0) {
							var gettpl = document.getElementById('goodslist').innerHTML;
							    laytpl(gettpl).render(data, function(html){
							    $(".ul_1").append(html);
							});
						}else {
							$(".loading_more").remove();
							$('.noData').show();
						} 
						$(".only-time").each(function(){
						    var sytime = $(this).attr('sytime');
						    var timeid = $(this).attr('id');
						    if(sytime > 0){
						    	addTimer(timeid, sytime);
						    }
						});
					},
					error: function() {
						$('.error').show();
					}
				});
			}
			addItems(pindex, psize);
			$(page).on('infinite', function() {
				if (loading) return;
				loading = true;
				$(".loading_more").show();
				setTimeout(function() {
					loading = false;
					pindex++;
					addItems(pindex, psize);
					$(".loading_more").hide();
					$.refreshScroller();
				}, 1000);
			});
		});
		$(document).on('click','#gzqiang',function(){
			var the = $(this);
		    var qgid = $(this).attr('qgid');
		    var gztext = $(this).text();
			if(gztext == '已关注'){
				$.alert('小淘气，不要重复关注哦');
				return false;
			}
			$.post("{php echo app_url('rush/home/follow')}",{qgid:qgid},function(d){
				if(d.result == 1){
				    $.toast(d.msg);
				    the.text('已关注');
				}else{
					$.toast(d.msg);
				}
			},"json");
		});
		$.init();
	});
    
    var addTimer = function () {     
        var list = [],     
            interval;     
    
        return function (id, time) {     
            if (!interval)     
                interval = setInterval(go, 1000);     
            list.push({ ele: document.getElementById(id), time: time });     
        }     
    
        function go() {     
            for (var i = 0; i < list.length; i++) {     
                list[i].ele.innerHTML = getTimerString(list[i].time ? list[i].time -= 1 : 0);     
                if (!list[i].time)     
                    list.splice(i--, 1);     
            }     
        }     
    
        function getTimerString(time) {     
                d = Math.floor(time / 86400),     
                h = Math.floor((time % 86400) / 3600),     
                m = Math.floor(((time % 86400) % 3600) / 60),     
                s = Math.floor(((time % 86400) % 3600) % 60);     
            if (time>0){
            	return "剩余：<span><label>" + d + "天</label><label>" + h + "小时</label><label>" + m + "分</label><label>" + s + "秒</label></span>";  
            }
        }     
    } ();
</script> 
</script>
{php include wl_template('common/footer');}
