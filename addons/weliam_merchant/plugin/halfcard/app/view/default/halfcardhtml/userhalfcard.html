{php include wl_template('common/header');}
<style>
.content{margin-top:150px;}
.halfcarddiv{background-color:white;padding:3px 10px;width:100%;margin-bottom:20px}
.halfcarddiv .storetitle{border-bottom:1px solid #F5F5F5;color:grey}
.storelogo{padding:5px}
.storelogo img{height:60px;width:100%;position:relative;top:10px}
.detailright{padding:5px}
.halfcarddetail{color:grey}
.detailfoot{padding-top:3px;border-top:1px solid #F5F5F5}
.detailfoot .qrcode{display:inline-block;color:orangered;border:1px solid orangered;padding:1px 5px;border-radius:5px;float:right}
.detailfoot:after{display:block;clear:both;content:"";visibility:hidden;height:0}
.detailright div{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:200px}
.nulltips{text-align:center;position:relative;top:5rem;color:#06C1AE}
.open-vip{width: 45%;background-color: orangered;color: white;float: right;font-size: 15px;display: inline-block;border: 1px solid orangered;border-radius: 5px;padding-top: 5px;padding-bottom: 5px;text-align: center;}
.tohalfcardlist{font-size:15px;display:inline-block;width:45%;border:1px solid orangered;color:orangered;border-radius:5px;float:left;padding-top:5px;padding-bottom:5px;text-align:center}
.blackimg{position:fixed;background-color:rgba(0,0,0,0.5);left:0;top:0;width:100%;height:100%;display:none;z-index:199}
.full-title,.q-a-list dt{display:inline-block;width:100%;background:#fff}
.card-banner{width:100%;height:auto}
.card-banner img{width:100%}
.setp{width:100%;height:auto}
.setp img{width:100%}
.full-title{text-align:center;padding-top:.7rem;padding-bottom:.7rem;line-height:1.2rem;font-size:1rem;border-bottom:#eee solid 1px;color:orangered}
.q-a-list{width:100%;height:auto;overflow:hidden}
.q-a-list dt{height:auto;line-height:.8rem;padding:.6rem .3rem;font-size:.7rem;color:#333}
.q-a-list dt span{position:relative;top:2px}
.q-a-list dt i{width:1rem;height:1rem;background:#ff512f;border-radius:.5rem;color:#fff;display:inline-block;float:left;text-align:center;line-height:1rem;margin-right:.24rem}
.q-a-list dd{line-height:1rem;font-size:.0.7rem;color:#666;padding:.25rem .3rem}
.mod-year-user,.mod-user-vip,.mod-user-qq{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:center;width:100%;height:247px;color:#fff}
.mod-year-user button,.mod-user-vip button,.mod-user-qq button{margin-top:17px;color:#fff;padding:0px 15px;height:28px;line-height:28px;border:1px solid #fff;font-size:14px;border-radius:2px;min-width:80px}
.mod-year-user button:active,.mod-user-vip button:active,.mod-user-qq button:active{opacity:0.5}
.mod-year-user,.mod-user-vip{background:#ebd6ad url({URL_APP_IMAGE}
vip/yearuser.jpg) no-repeat center bottom;background-size:100% auto}
.mod-year-user .user-header-front{position:absolute;top:0px;left:0px;width:118px;height:92px;background:url({URL_APP_IMAGE}
vip/header-bgsvip.png) no-repeat center bottom;background-size:100% auto;-webkit-transform-style:preserve-3d;backface-visibility:hidden;-webkit-backface-visibility:hidden;z-index:10}
.mod-year-user .user-header-front span{position:absolute;right:24px;top:15px;display:block;width:70px;height:70px;border-radius:70px;background-repeat:no-repeat;background-position:center center;background-size:100% auto}
.mod-year-rule{position:relative}
.user-info{font-size:22px;line-height:1;margin-top:16px}
.user-level{display:-webkit-box;-webkit-box-pack:center;line-height:1;margin-top:8px;font-size:14px}
.user-level p{margin-right:3px}
.user-level span{font-size:14px}
.user-header-rotate{position:relative;width:118px;height:88px;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;margin-top:24px;z-index:19;transform:translateZ(0)}
.title-banner{margin:15px 15px 0 15px;width:auto;height:30px;line-height:30px;background:url({URL_APP_IMAGE}
vip/title-bg.png) no-repeat center bottom;background-size:auto 100%;text-align:center;font-size:16px;color:#777777}
.mod-year-rule .rule-content{overflow:hidden;padding-bottom:1px;margin-bottom:15px;padding:10px}
.mod-year-rule ul{font-size:14px;color:#7f7f7f;padding:0px 15px 15px;box-sizing:border-box;margin-bottom:15px}
.mod-year-rule p:nth-child(2){padding:0px 15px;box-sizing:border-box;font-size:14px;color:#7f7f7f;margin-top:19px}
.modal-inner{padding:.75rem 0 0 0;background-color:white}
.modal-button{background-color:white}
.memberinfo{position: fixed;left: 0;top: 0;z-index: 199;height: 100px;width: 120%;background-color: white;margin-bottom: 5px;}
.memberinfo img{width: 65px;height: 65px;border-radius: 100%;position: relative;top: 18px;left: 25px;margin: 0 10px;}
.userin{position: relative;top: 18px;left: 30px;}
a:active{}
.buttons-tab:before{content: '';position: absolute;left: 0;top: 0;bottom: auto;right: auto;height: 1px;width: 100%;background-color: #e7e7e7;display: block;z-index: 15;-webkit-transform-origin: 50% 0%;transform-origin: 50% 0%;}
</style>
<div class="page-group" >
    <div class="page page-current" id="page-index">
    	<div class="memberinfo row">
    		<div class="col-35">
    			<img src="{php echo tomedia($user['avatar'])}"/>
    		</div>
    		<div class="col-65 userin">
				<div>持卡人：{$user['nickname']}</div>
				<div>手机号:  &nbsp;{$user['mobile']}</div>
				<div>有效期：<span style="color: orangered;">{if $member['expiretime']>time()}{php echo date('Y-m-d H:i:s',$member['expiretime'])}{else}已失效{/if}</span></div>
    		</div>
    	</div>
    	<div class="bar bar-standard bar-footer" style="padding:10px;height: auto;">
		    <div class="tohalfcardlist">查看五折商家</div><div href="javascript:;" class="open-vip">续费五折卡</div>
		</div>
		<div class="blackimg"></div>
		<div class="modal modal-in" style="display:none; margin-top: -171px;background-color: white;z-index: 9999;">
			<div class="modal-inner" style="background-color: white;">
				<div class="modal-title">
					选择续费时长
				</div>
				<div class="modal-text">
					<div class="list-block media-list">
						<ul>
							{loop $hcprice $item}
							<li>
								<label class="label-checkbox item-content">
									<input type="radio" name="my-radio" price="{$item['price']}"  value="{$item['days']}">
									<div class="item-media">
										<i class="icon icon-form-checkbox">
										</i>
									</div>
									<div class="item-inner">
										<div class="item-title-row">
											<div class="item-title">
												{$item['name']}({$item['days']}天  {$item['price']}元)
											</div>
											<div class="item-after">
											</div>
										</div>
									</div>
								</label>
							</li>
							{/loop}
							<li>
								<a href="{php echo app_url('halfcard/halfcard_app/activation')}">
								<label class="label-checkbox item-content">
									<div class="item-inner">
										<div class="item-title-row">
											<div class="item-title" style="display: block;width: 100%;text-align: center;">
												使用激活码
											</div>
										</div>
									</div>
								</label>
								</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="modal-buttons ">
				<span class="modal-button" style="background-color: white;">
					续费
				</span>
			</div>
		</div>
    	<div class="buttons-tab" style="z-index: 100;top: 100px;">
	      <a id="tab1" class="tab-link button tabpr {if $status=='1'}active{/if}" >今日</a>
	      <a id="tab3" class="tab-link button tabpr {if $status=='3'}active{/if}" >过期</a>
	    </div>
	    <style type="text/css">
		.addfriend-box{ position: fixed; z-index: 10000000; left:0; top: 0;  width: 100%; height: 100%; background:rgba(0,0,0,0.8);}
		.addfriend-content{position: relative;top:0rem;width:90%;left: 5%;}
		.addfriend-content h2{font-size:1.2rem; line-height: 1.2rem; color: #ff556d; font-weight: bold; margin-bottom:0.8rem;}
		.addfriend-content p{ font-size:1.5rem; line-height:1.5rem; color: #666; margin-bottom:0rem;}
		.addfriend-close{width:2rem; height:2rem; }
		.addtitle{position:relative;text-align: center;}
		.addtitle .titleimg{width:100%;height: 35%;}
		.addtitle .storename{color: white;position: relative;top: -1.3rem;font-size: .75rem;}
		.datetime #datetime{color: orangered;}
		.addresss{border-bottom: 1px solid #F5F5F5;}
		.qrimg{text-align: center;margin-top: 0.3rem;}
		.qrimg img{width: 5rem;height: 5rem;}
		.qrcode{text-align: center;margin-top: 0.3rem;border-bottom: 1px solid #F5F5F5;}
		.qrcode #halfcardqrcode{color: orangered;}
    	</style>
		<div class="addfriend-box" id="qrcode" style="display: none;" >
		 <div class="addfriend-content">
			<div class="addtitle">
		 		<img class="titleimg" src="{URL_APP_IMAGE}halfcard/expand.png" />
				<div class="storename" id="storename"></div>
			</div>
			<div style="background-color: white;position: relative;top: -1.2rem;padding: .3rem;border-radius: 0  0 5px 5px;">
				<div class="datetime">使用时间：<span id="datetime"></span></div><div style="clear:both"></div>
				<div class="addresss"><i class="icon iconfont icon-location"></i><span id="storeaddress"></span></div><div style="clear:both"></div>
			    <div class="qrimg"><img id="qrimg" src=""></div>
			    <div class="qrcode">验证码:<span id="halfcardqrcode"></span></div>
			    <div class="shoptips" style="margin-top: .3rem;"><i class="icon iconfont icon-shop"></i> 买单时向服务员出示即可</div>	
			</div>    
		 </div>
		 	<div style="text-align: center;"><img class="addfriend-close" src="{URL_APP_IMAGE}halfcard/f-close.png" /></div>
		</div>
		<div class="content native-scroll">
			<div class="wsyyhq">
				{loop $todays $today}
				<div class="halfcarddiv">
					<div class="storetitle">
						<i class="icon iconfont icon-shop"></i><span>&nbsp;{$today['storename']}</span>
						{if $today['status']==1}
						<span style="float: right;color: orangered;">未消费</span>
						{else}
						<span style="float: right;color: gray;">已核销</span>
						{/if}
					</div>
					<div class="halfcarddetail row">
						<div class="col-25 storelogo"><img src="{$today['logo']}"></div>
						<div class="col-75 detailright">
							<div>{$today['title']}</div>
							<div style="color: orangered;">{$today['limit']}</div>
							<div>验证码:<span style="float: right;color: orangered;">{$today['qrcode']}</span></div>
						</div>
					</div>
					{if $today['status'] == 1}<div class="detailfoot"><div class="qrcode"><input type="hidden" value="{$today['id']}"><input type="hidden" storename="{$today['storename']}" storeaddress="{$today['address']}"  value="{$today['qrcode']}"><i class="icon iconfont icon-qrcode"></i>&nbsp二维码</div></div>{/if}
				</div>
			    {/loop}
			</div>
			<div style="display: none;" class="ygqyhq">
				{loop $overdues $overdue}
				<div class="halfcarddiv">
					<div class="storetitle">
						<i class="icon iconfont icon-shop"></i><span>&nbsp;{$overdue['storename']}</span>
						{if $overdue['status']== 2}
						<span style="float: right;color: orangered;">已核销</span>
						{else}
						<span style="float: right;color: gray;">已过期</span>
						{/if}
					</div>
					<div class="halfcarddetail row">
						<div class="col-25 storelogo"><img src="{$overdue['logo']}"></div>
						<div class="col-75 detailright">
							<div>{$overdue['title']}</div>
							<div style="color: orangered;">{$overdue['limit']}</div>
							<div>购买时间:&nbsp;{$overdue['createtime']}</div>
							<div>使用日期:<span style="float: right;color: orangered;">{$overdue['date']}</span></div>
						</div>
					</div>
				</div>
			    {/loop}
			</div>
		</div>
	</div>
<script>
	$(function(){
		if ($('.ygqyhq').html().length < 20) {
			var x = "<div class='nulltips'>您没有过期五折优惠</div>";
			$('.ygqyhq').html(x);
		}
		if ($('.wsyyhq').html().length < 20) {
			var x = "<div class='nulltips'>您今天没有享受五折优惠</div>";
			$('.wsyyhq').html(x);
		}
	});
	$('.tabpr').click(function(){
		$('.tabpr').each(function(){
			$(this).removeClass('active');
		});
		$(this).addClass('active');
		id = $(this).attr('id');
		if (id == 'tab1') {
			$('.wsyyhq').show();
			$('.ysyyhq').hide();
			$('.ygqyhq').hide();
		}else if(id == 'tab3'){
			$('.wsyyhq').hide();
			$('.ysyyhq').hide();
			$('.ygqyhq').show();
		}
	});

	$('.qrcode').click(function(){
		var id = $(this).children().eq(0).val();
		var qrcode = $(this).children().eq(1).val();
		var storename = $(this).children().eq(1).attr('storename');
		var storeaddress = $(this).children().eq(1).attr('storeaddress');
		$.post("{php echo app_url('halfcard/halfcard_app/createqrcodeimg')}",{id:id},function(d){
			$('#halfcardqrcode').text(qrcode);
			$('#storename').text(storename);
			$('#storeaddress').text(storeaddress);
			$('#datetime').text(d.datetime);
			$('#qrimg').attr('src',d.qrsrc);
			$('#qrcode').show();
		},"json");
	});
	$('.addfriend-close').click(function(){
		$('#qrcode').hide();
	});
	
	$('.tohalfcardlist').click(function(){
		location.href="{php echo app_url('halfcard/halfcard_app/halfcardlist')}";
	});
	
	$('.open-vip').click(function(){
		$('.modal-in').show();
		$('.blackimg').show();
	});
	$('.blackimg').click(function(){
		$('.modal-in').hide();
		$('.blackimg').hide();
	});
	$('.modal-button').click(function(){
		var paytype = "wechat";
	    var radioValue = $('input[name="my-radio"]:checked').val();
	    var price = $('input[name="my-radio"]:checked').attr('price');
	    $.post("{php echo app_url('halfcard/halfcardopen/createOrder')}",{radioValue:radioValue,price:price},function(d){
	     if(d.errno == 2){
		 		$.confirm(d.message,function () { //确定后操作。
				    location.href = "{php echo app_url('member/user/binding',array('backurl'=>urlencode(app_url('halfcard/halfcardopen/open'))));}";
			      },function () { //取消后操作。
			      	 history.go(0);
			      }
		    	);
		 	}else if(d.errno == 1){
		 		$.confirm(d.message,function () { //确定后操作。
				    location.href = "{php echo app_url('member/user/index')}";
			      },function () { //取消后操作。
				    location.href = "{php echo app_url('member/user/index')}";
			      }
		    	);
		 	}else{
		 		location.href = "{php echo app_url('common/wlCommon/wlPay');}&payType="+paytype+"&orderId="+d.message+"&orderType=halfCard"+"&toPay=1";
		 	}
	    },"json");
	});
</script>
</div>	
		
{php include wl_template('common/footer');}