{php include wl_template('common/header');}
<style type='text/css'>
       .trbody td {text-align: center; vertical-align:top;border-left:1px solid #ccc; border-bottom: 1px solid #ddd;}
</style>
<style>
	.order-rank img{width:16px; height:16px;}
	.js-remark,.js-admin-remark{word-break:break-all; overflow:hidden; background: #FDEEEE;color: #ED5050;padding: 5px 10px;}
	td.goods-info{position:relative; padding-left:60px;}
	.goods-info .img{position:absolute;top:50%; margin-top:-25px; background: url({IMAGE_LOADING}) center center no-repeat; width:50px;height:50px; }
	.goods-info span {white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: block;}
	.status-text{cursor:pointer;}
	.table>thead>tr>th, .table>tbody>tr>th, .table>tfoot>tr>th, .table>thead>tr>td, .table>tbody>tr>td, .table>tfoot>tr>td {border-top: 1px solid rgba(221, 221, 221, 0);}
	.col-md-1{padding-right: 0px;}
	.all-tips{
		    margin-left: 65px;
	}
	span.effect-time {
    font-size: 12px;
    display: block;
    font-weight: 500;
}
.row.row-fix, .form-group.form-group-fix {
    margin-left: -15px;
    margin-right: -15px;
    width: 500px;
}
button.btn.btn-default.daterange.daterange-date {
    float: left;
    margin-left: 380px;
   position: absolute;
   z-index: 100;
}
#sel_child{
	display: none;
}
.show1{
	display: block;
}
.hide1{
	display: none;
}

.daterange-date{
	display: none;
}
.sty {
    display: block;
    width: 100%;
    font-size: 13px;
    height: 46px;
    overflow: hidden;
    white-space: nowrap;
    line-height: 46px;
    text-overflow: ellipsis;
    text-align: center;
}
.spe {
    display: inline-block;
    text-align: center;
    display: block;
    height: 33px;
    margin-left: -12px;
    padding-top: 0px;
    line-height: 33px;
}
.table>thead>tr>td, .table>tbody>tr>td, .table>tfoot>tr>td {
    white-space: normal;
}
span.ppp {
    text-align: center;
    display: inline-block;
    font-size: 14px;
    width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    color: #e43;
}
.todetail{
	text-align: center;
    display: inline-block;
    font-size: 14px;
    width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    color: deepskyblue;
    }
.todetail:hover{cursor:pointer;}


</style>
<div class="panel">
	    <div class="panel-body">
            <form action="" method="get" class="form-horizontal" role="form" id="form1">
               	<input type="hidden" name="c" value="site" />
	            <input type="hidden" name="a" value="entry" />
	            <input type="hidden" name="m" value="weliam_merchant" />
	            <input type="hidden" name="p" value="coupon" />
				<input type="hidden" name="ac" value="couponlist" />
				<input type="hidden" name="do" value="couponsList" />
                <div class="form-group">
                    <div class="col-md-2" id="double">
                        <!--<select name="keywordtype" class="form-control">
                        	<option value="">关键字类型</option>
                            <option value="1" {if $_GPC['keywordtype']==1}selected="selected"{/if}>优惠券类型</option>
                            <option value="2" {if $_GPC['keywordtype']==2}selected="selected"{/if}>优惠券状态</option>
                          <option value="3" {if $_GPC['keywordtype']==3}selected="selected"{/if}>优惠券XX</option>
                          
                        </select>-->
                        {php echo tpl_form_field_category_2level('sel',$sel1, $sel2, $_GPC['sel']['parentid'], $_GPC['sel']['childid']);}
                    </div>
                    <div class="col-md-2">
                    	{php echo tpl_form_field_daterange('time_limit', array('starttime' => date('Y-m-d',$starttime), 'endtime' => date('Y-m-d', $endtime)));}
                    </div>
                    <div class="col-md-6 pull-right">
						<div class="input-group">
							
							<span class="input-group-addon" id="search" style="border: 1px solid #999;width: 90px;cursor: pointer;display: block;margin-left: 29rem; border-radius: 3px;" >搜索</span>
						</div>
					</div>
				</div>
            </form>
	    </div>
	</div>
	<script type="text/javascript">
		$("#search").click(function(){
			$('#form1')[0].submit();
		});
	</script>
	<!------------------------------------------------------>
<div class="order-list">
		<div class="panel-body table-responsive collapse in" id="order-template-item-4" style="padding: 0;">
			<table class="table table-bordered">
				<thead style="background-color: #FFFFFF;">
					<tr>
						<th style="width:50px">序号</th>
						<th style="width:250px;text-align:center;">优惠券内容</th>
						<th style="width:100px; text-align:center;">已售/库存</th>
						<th style="width:80px; text-align:center;">所属商家</th>
						<th style="width:80px; text-align:center;">类型</th>
						<th style="width:100px; text-align: center;">介绍</th>
						<th style="width:80px; text-align: center;">优惠券价格</th>
						<th style="width:80px; text-align:center;">优惠券状态</th>
						<th style="width:130px; text-align:center;">有效时间</th>
					</tr>
				</thead>
				
			</table>
		</div>
		{loop $coupons $y $item}
		<div class="panel panel-default">
			<div class="panel-heading clearfix" style="padding: 10px 15px;">
				<div class="pull-left">
					<span><a href="{php echo web_url('wlcoupon/couponlist/merbercoupon', array('parentid' => $item['id'],'title'=>$item['title']))}" >用户查询</a></span>
				</div>
				<div class="pull-right">
					<span class="text-muted"></span>&nbsp;&nbsp;
					<a href="javascript:;" data-id="{$item['id']}"  data-url="{php echo app_url('wlcoupon/coupon_app/couponsdetail',array('id'=>$item['id']))}" id="js-copy{$item['id']}" class="js-copy">复制链接</a>-
					{if $item['status'] != 3}
					<a href="javascript:;" class="js-disable" order-id="{$item['id']}"> 使失效 -</a> 
					<a href="{php echo web_url('wlcoupon/couponlist/editCoupons', array('id' => $item['id']))}" class="js-edit" order-id="{$item['id']}"> 编辑 </a> 
					<a href="javascript:;" style="display: none;" > 已失效 -</a> 
					{else}
					<a href="javascript:;" > 已失效</a> -
					{/if}
					<!--<a href="javascript:;" class="js-remove" order-id="{$item['id']}" >删除</a>-->
				</div>
			</div>
			<div class="panel-body table-responsive" style="padding: 0px;">
				<table class="table table-bordered">
					<tbody >
						<tr>
							<td style="width: 50px;" ><center>{php echo $y+1}</center></td>
							<td class="goods-info line-feed" style="width:250px;padding-left: 10px;">
								<div class="img"><img width="50" height="50" class="oscrollLoading" data-url="{php echo tomedia($item['logo'])}" height="50" width="50" ></div>
								<div class="all-tips">
									{if $item['type']==1}<span class="">{$item['title']}</span>{/if}
									{if $item['type']==2}<span class="">{$item['title']}</span>{/if}
									{if $item['type']==3}<span class="">{$item['title']}</span>{/if}
									{if $item['type']==4}<span class="">{$item['title']}</span>{/if}
									{if $item['type']==5}<span class="">{$item['title']}</span>{/if}
								</div>
								
							</td>
							<td class="text-center" style="width:100px;;height:60px">
							
								<p>{$item['surplus']}&nbsp;/&nbsp;{$item['quantity']}</p>
							</td>
							<td class="text-center" style="width:80px; font-family: "Arial","Microsoft YaHei","黑体","宋体",sans-serif ;">{$item['storename']}</td>
							<td class=" line-feed" style="width:80px;padding-left: 10px;">
								<div class="title" style="padding-left: 10px;position: relative;">
									<!--优惠券类型 1 折扣券 2代金券 3套餐券 4 团购券 5优惠券-->
									{if $item['type']==1}<span class="label label-white ">折扣券</span>{/if}
									{if $item['type']==2}<span class="label label-success ">代金券</span>{/if}
									{if $item['type']==3}<span class="label label-warning-light ">套餐券</span>{/if}
									{if $item['type']==4}<span class="label label-info ">团购券</span>{/if}
									{if $item['type']==5}<span class="label label-danger ">优惠券</span>	{/if}
								</div>
							</td>
							<!---->
							<td class=" line-feed" style="width:100px;padding-left: 10px;">
								<div class="title" style="padding-left: 5px;position: relative;">
									<span class="todetail"  couponid="{$item['id']}">查看详情</span>
								</div>
							</td>
							<!---->
							<td class="text-center" style="width:80px;">
								{if $item['price']==0}<span class="label label-success stat">免费</span>{/if}
								{if $item['price'] != 0}<span class="label label-danger stat">￥{$item['price']}</span>{/if}	
							</td>
							<td class="text-center" style="width:80px;">
								{if $item['status']==0}<span class="label label-danger stat">未启用</span>{/if}
								{if $item['status']==1}<span class="label label-warning stat">已启用</span>{/if}	
								{if $item['status']==3}<span class="label label-info stat">已失效</span>{/if}							
							</td>
							<td class="text-center" style="width:130px;">
								<span class="effect-time">
								{if $item['time_type']==1}
								起始日期:{php echo date('y-m-d',$item['starttime'])} <br />
								终止日期:{php echo date('y-m-d',$item['endtime'])}
								{/if}
								{if $item['time_type']==2}
								领取后的天数:{$item['deadline']} <br />
								{/if}
								</span>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<!--<div class="panel-heading clearfix" style="padding: 10px 15px;background-color:lightgoldenrodyellow;word-break: break-all;overflow: hidden;color: #ED5050;padding: 5px 10px;border-top:1px solid #ddd;">
				<div class="pull-left">
					<span>使用须知: <span id="desc"></span></span>
				</div>
			</div>-->
		</div>
		{/loop}
		{$pager}
	</div>
	
</div>
<script type="text/javascript">
	require(['jquery', 'util'], function($, util){
		$('.js-copy').each(function(){
			var id=$(this).attr('data-id');
			util.clip($("#js-copy"+id), $(this).attr('data-url'));
		});
	});
</script>
<div id="modal-module-gift" class="modal fade" tabindex="-1">
    <div class="modal-dialog" style='width: 920px;'>
        <div class="modal-content">
            <div class="modal-header">
                <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                <h3>卡券详情</h3>
            </div>
            <div class="modal-body">
               <div id="detail" class="modal-body"></div>	
            </div>
            <div class="modal-body">
            	<h4>使用须知</h4>
               <div id="detail2" class="modal-body"></div>	
            </div>
            <div class="modal-footer" style="padding: 5px 15px;">				
				<a class="btn btn-primary js-order-remark-post" order-id="" data-dismiss="modal" aria-hidden="true">确定</a>			
			</div>	
        </div>
    </div>
</div>
<script type="text/javascript">
	require(['jquery', 'util'], function($, util){
		$('.js-copy').each(function(){
			var id=$(this).attr('data-id');
			util.clip($("#js-copy"+id), $(this).attr('data-url'));
		});
	});
	$('.todetail').click(function(){
		popwin = $('#modal-module-gift').modal();
		var id = $(this).attr('couponid');
		$.post("{php echo web_url('wlcoupon/couponlist/todetail')}",{id:id},function(d){
			if(!d.errno){
				$('#detail').html(d.data);
				$('#detail2').html(d.data2);
			}
		},"json");
		//$('#double').hide();
	});
</script>
<script type="text/javascript">
	$('#output').click(function(){
		var orderType = '{$_GPC['orderType']}';
		var status = '{$_GPC['status']}';
		var paytype = '{$_GPC['pay_type']}';
		var keywordtype = '{$_GPC['keywordtype']}';
		var keyword = '{$_GPC['keyword']}';
		var timetype = '{$_GPC['timetype']}';
		var times = "{$_GPC['time']['start']}";
		var timee = "{$_GPC['time']['end']}";
		location.href = "{php echo web_url('order/order/output')}&orderType="+orderType+"&status="+status+"&paytype="+paytype+"&keywordtype="+keywordtype+"&keyword="+keyword+"&timetype="+timetype+"&times="+times+"&timee="+timee;
	});
	$(function(){
		$('[name="rank_all"]').click(function() {
			var checked = this.checked;
			$('.js-rank').find('input:checkbox').each(function() {
				this.checked = checked;
			});
		});
		$('#export').click(function() {
			if ($('[name="selecttime[start]"]').val() == '') {
				alert('请选择下单时间');
				$(this).focus();
				return false;
			};
			$(this).attr('type', 'submit').submit();
		});
		
		$('.order-rank').each(function(){
			o.rank(this);
		});
		
		$(".oscrollLoading").scrollLoading();
		var $pop = null;
		$('.goods-info').hover(function() {
			var obj = this;
			var img = $(this).find('img').attr('src');
			var $pop = util.popover(obj, function($popover, obj) {
				obj.$popover = $popover;
			}, '<div><img src="'+ img+'" style="max-width:200px; max-height:200px;"></div>');
		}, function() {
			this.$popover.remove();
		});

		
		//删除
		$('.order-list').delegate('.js-remove', 'click', function(e){
			e.stopPropagation();
			var $this = $(this);
			var id = $this.attr('order-id');
			util.nailConfirm(this, function(state) {
				if(!state) return;
				$.post("{php echo web_url('wlcoupon/couponlist/deleteCoupons')}", { id : id }, function(data){
					if(!data.errno){
					$this.parent().parent().parent().remove();
					util.tips("删除成功！");
					};
				}, 'json');
			}, {html: '确认删除?'});
		});
		$('#de1').delegate('.js-delete','click',function(e){
			e.stopPropagation();
			var order_ids = [];
			var $checks=$('.checkbox:checkbox:checked');
			$checks.each(function() {
				if (this.checked) {
					order_ids.push(this.value);
				};
			});
				var $this = $(this);
				var ids = order_ids;
			//	alert(ids);
				util.nailConfirm(this, function(state) {
				if(!state) return;
					$.post("{php echo web_url('rush/order/deleteOrder')}", { ids : ids }, function(data){
						if(!data.errno){
						util.tips("删除成功！");
						location.reload();
						};
					}, 'json');
				}, {html: '确认删除?'});
			});
		});
		
$('.js-disable').click(function(e) {
		e.stopPropagation();
		var id = $(this).attr('order-id');
		var asd = $(this);
		util.nailConfirm(this, function(state) {
			if (!state) return;
			$.post("{php echo web_url('wlcoupon/couponlist/disable')}", {id : id}, function(data) {
				if(!data.errno){
					asd.hide();
					asd.next().hide();
					asd.next().next().show();
				};
				util.tips(data.message);
			}, 'json');
		}, {html:'<div class="inner__content"><span style="color:red;font-size:12px;">失效后将导致该优惠券无法被领取和编辑</span></div>确定让这组优惠券失效?', placement:'left'});
	});




$('#sel_parent').click(function(){
	if(this.value==3){
		$('.daterange-date').show();
		$('#sel_child').hide();
		$("#sel_child").removeAttr("style");
		$('#sel_child').attr("display","none");
		$('#sel_child').addClass('hide1');
	}
	else{
		$('.daterange-date').hide();
		$('#sel_child').show();
		$('#sel_child').attr("display","block");
	}
});

$(function(){
	if($('#sel_parent').val() == 1 || $('#sel_parent').val() == 2 ) {
		$('#sel_child').show();
		$('.daterange-date').hide();
	}else if($('#sel_parent').val() == 3){
		$('#sel_child').hide();
		$('.daterange-date').show();
	}
});




</script>

{php include wl_template('common/footer');}