{php include wl_template('common/header');}
<ul class="nav nav-tabs" id="myTab">
	<li {if $_GPC['postType']=='list'}class="active"{/if} ><a href="{php echo web_url('member/token/token',array('postType'=>'list'))}">激活码列表</a></li>
	<li {if $_GPC['postType']=='add'}class="active"{/if}><a href="{php echo web_url('member/token/token',array('postType'=>'add'))}">增加激活码</a></li>
</ul>
{if $_GPC['postType']=='list'}
<div class="panel panel-default">
	<div class="panel-heading">筛选</div>
	<div class="panel-body">
		<form action="./index.php" method="get" class="form-horizontal" role="form">
			<input type="hidden" name="c" value="site" />
            <input type="hidden" name="a" value="entry" />
            <input type="hidden" name="m" value="weliam_manage" />
            <input type="hidden" name="do" value="secretkey" />
			<input type="hidden" name="ac" value="secretkey" />
			<input type="hidden" name="op" value="display" />
            <div class="form-group">
            <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">关键字类型</label>
            <div class="col-sm-8 col-lg-9 col-xs-12">
	          	<select name="type" class="form-control">
					<option value="2" {if $_GPC['type'] == 2}selected{/if} >VIP邀请码类型</option>
					<option value="3" {if $_GPC['type'] == 3}selected{/if} >时长</option>
					<option value="4" {if $_GPC['type'] == 4}selected{/if} >价格</option>
				</select>
            </div>
            </div>
            <div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">关键字</label>
				<div class="col-xs-12 col-sm-5">
					<input type="text" class="form-control" name="keyword" id="keyword" value="{$_GPC['keyword']}" />
				</div>
				<div class="pull-right col-md-2">
					<button class="btn btn-default"><i class="fa fa-search"></i> 搜索</button>
				</div>
			</div>
        </form>
	</div>
</div>
<form action="{php echo web_url('secretkey/secretkey/download')}" method="post" class="form-horizontal" role="form">
	<div class="panel panel-default">
		<div class="panel-heading">导出</div>
		<div class="panel-body">
			<div class="form-group">
				<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label"><span style="float: right;margin-top: 3%;">导出记录</span></label>
				<div class="col-sm-4 col-lg-4 col-xs-12">
					<select name="type_id" class="form-control">
						<option value="all">全部</option>
						{loop $secretkey_type $row}
			            <option value="{$row['secretkey_type_id']}">{$row['type_name']}</option>
						{/loop}}
			        </select>
				</div>
				<div class="col-sm-3 col-lg-3 col-xs-12">
					<button class="btn btn-info" style="float: right;" type="submit">导出记录</button>
				</div>
			</div>
		</div>
	</div>
</form>
<div class="panel panel-default">
	<div class="table-responsive">
		<table class="table table-hover table-bordered">
			<thead>
			<tr>
				<th  class="text-center" style="width:90px;">密钥类型</th>
				<th class="text-center" style="width:120px;">IP<br/>绑定域名</th>
				<th class="text-center" style="width:60px;">密钥状态</th>
				<th class="text-center" style="width:100px;">创建时间<br>更新时间</th>
				<th class="text-center" style="width:60px;">复制</th>
				<th class="text-center" style="width:120px;">备注</th>
				<th class="text-center" style="width:100px;">操作</th>
			</tr>
			</thead>
			<tbody>
				{loop $list $item}
				<tr class="text-center" >
					<td>
						{if $item['secretkey_type']=='夺宝商城'} 
						<span class="label label-success">
						{$item['secretkey_type']}
						</span> 
						{elseif $item['secretkey_type']=='拼团商城'}
						<span class="label label-warning">
						{$item['secretkey_type']}
						</span> 
						{elseif $item['secretkey_type']=='微信挪车旗舰版'}
						<span class="label label-primary">
						{$item['secretkey_type']}
						</span> 
						{else}
						<span class="label label-danger">
						{$item['secretkey_type']}
						</span> 
						{/if}
					</td>
					<td>
						{$item['member_ip']}<br/>
					{$item['member_name']}
					</td>
					<td>
						{if $item['status']==1} 
						<span id="" class="label label-success">
						使用中
						</span> 
						{else}
						<span id="" class="label label-default">
						空闲
						</span> 
						{/if}
					</td>
					<td>{php echo date('Y-m-d H:i:s',$item['createtime'])}<br>{php echo date('Y-m-d H:i:s',$item['updatetime'])}</td>
					<td style="position:relative;">
					<a href="javascript:;" data-id="{$item['secretkey']}"  data-url="{$item['secretkey']}" id="js-copy{$item['secretkey']}" class="js-copy">复制密钥</a>
					</td>
					<td>
						<input style="width: 100%;" type="text" name="remark" id="{$item['secretkey']}" class="form-control" value="{$item['remark']}" />
					</td>
					<td>
						<button type="button" class="btn btn-primary" onclick="set_remark('{$item['secretkey']}');"><i class="fa fa-check"></i></button>
						<button type="button" class="btn btn-primary" onclick="addip('{$item['secretkey']}');"><i class="fa fa-copy"></i></button>
						<a href="{php echo web_url('secretkey/secretkey/delete')}&secretkey_id={$item['secretkey_id']}" onclick="return confirm('将删除【{$item['remark']}】的【{$item['secretkey_type']}】密匙绑定！！！');return false;" class="btn btn-danger"><i class="fa fa-trash-o"></i></a>
					</td>
				</tr>
				{/loop}
			</tbody>
		</table>
	</div>
</div>
{$pager}
<script type="text/javascript">
	require(['jquery', 'util'], function($, util){
		$('.js-copy').each(function(){
			var id=$(this).attr('data-id');
			util.clip($("#js-copy"+id), $(this).attr('data-url'));
		});
	});
	function set_remark(id){
		var remark = $('#'+id).val();
		$.post("{php echo web_url('secretkey/secretkey/remark')}"
			,{id:id,remark:remark}
			,function(d){
				layer.alert(d.message);
			}
			,"json"
		);
	}
	function addip(id){
		layer.prompt({title: '输入IP或IP段', formType: 2}, function(pass, index){
			layer.close(index);
			$.post("{php echo web_url('secretkey/secretkey/addip')}",{id:id,pass:pass},function(d){
				layer.alert(d.message);
			},"json");
		});
	}
</script>
{/if}
{if $_GPC['postType']=='add'}
<div class="main">
	<form action="" method="post" class="form-horizontal form" id="form">
		<div class="tab-content">
			<div class="panel panel-default">
				<div class="panel-heading">基本信息</div>
				<div class="panel-body">
					<div class="panel-body">
						<div class="form-group">
							<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span>激活码类型</label>
							<div class="col-md-6">
								<select name="secretkey_type" class="form-control">
								{loop $types $row}
						            <option value="{$row['id']}">{$row['name']}</option>
								{/loop}
						        </select>
							</div>
						</div>
						<div class="form-group">
							<label class="col-xs-12 col-sm-3 col-md-2 col-lg-2 control-label">创建个数</label>
							<div class="col-xs-12 col-sm-8">
								<input style="width: 50%;" type="text" name="num" class="form-control" placeholder="创建个数1" />
							</div>
						</div>
						<div class="form-group col-sm-12">
							<input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1" />
							<input type="hidden" name="token" value="{$_W['token']}" />
						</div>
					</div>
				</div>
			</div>
		</div>
	</from>
</div>
{/if}
{php include wl_template('common/footer');}