{php include wl_template('common/header');}
<div class="page-group" >
    <div class="page page-current" id="page-index">
		<header class="bar bar-nav create-actions">
			<a class="button button-link button-nav pull-left back" href="{php echo app_url('store/supervise/platform')}"><span class="icon icon-left"></span>返回</a>
			<h1 class='title' class="">{$name}订单 <span class="icon iconfont icon-triangledownfill" style="margin-bottom: 4px;font-size: 10px;"></span></h1>
		</header>
		<div class="content infinite-scroll">
		  	<div class="buttons-tab">
			    <a href="{php echo app_url('store/supervise/order',array('status'=>1,'type'=>$type))}" class="button {if $status == 1}active{/if}">待消费</a>
				<a href="{php echo app_url('store/supervise/order',array('status'=>2,'type'=>$type))}" class="button {if $status == 2}active{/if}">已消费</a>
				<a href="{php echo app_url('store/supervise/order',array('status'=>5,'type'=>$type))}" class="button {if $status == 5}active{/if}">已取消</a>
				<a href="javascript:;" class="button {if $status == 6 || $status == 7}active{/if} open-popover" data-popover=".popover-order-status">{if $status == 6}待退款{elseif $status == 7 }已退款{else}更多{/if} <i class="iconfont icon-unfold"></i></a>
			</div>
			<div class="allorder" style="margin-top: .5rem;">
			</div>
			<div class="weui-loadmore loading_more" style="display: none;">
	            <i class="weui-loading"></i>
	            <span class="weui-loadmore__tips">正在加载</span>
	        </div>
	        <div class="weui-loadmore weui-loadmore_line" style="display: none;">
	            <span class="weui-loadmore__tips" style="background-color: #EFEFF4;">暂无更多数据</span>
	        </div>
	    </div>
	</div>
</div>
<div class="popover popover-manage popover-order-status">
	<div class="popover-angle"></div>
	<div class="popover-inner">
		<div class="list-block">
			<ul>
				<li><a href="{php echo app_url('store/supervise/order',array('status'=>6,'type'=>$type))}" class="list-button item-link">待退款</a></li>
				<li><a href="{php echo app_url('store/supervise/order',array('status'=>7,'type'=>$type))}" class="list-button item-link">已退款</a></li>
				<li><a href="javascript:;" class="list-button item-link close-popover">关闭</a></li>
			</ul>
		</div>
	</div>
</div>
<script type="text/html" id="orderlist">
{{# for(var i = 0, len = d.data.length; i < len; i++){ }}
<div class="weui-form-preview">
    <div class="weui-form-preview__hd">
        <label class="weui-form-preview__label">{{ d.data[i].gname }}</label>
        <em class="weui-form-preview__value">¥ {{ d.data[i].price }}</em>
    </div>
    <div class="weui-form-preview__bd">
        <div class="weui-form-preview__item">
            <label class="weui-form-preview__label">购买人</label>
            <span class="weui-form-preview__value">{{ d.data[i].nickname }} {{ d.data[i].mobile }}</span>
        </div>
        <div class="weui-form-preview__item">
            <label class="weui-form-preview__label">订单状态</label>
            <span class="weui-form-preview__value">
            	{{# if(d.data[i].status == 1){ }}待消费{{# } else if(d.data[i].status == 2){ }}已消费{{# } else if(d.data[i].status == 5){ }}已取消{{# } else if(d.data[i].status == 6){ }}待退款{{# } else if(d.data[i].status == 7){ }}已退款{{# } else if(d.data[i].status == 0){ }}待付款{{# } }}
            </span>
        </div>
        <div class="weui-form-preview__item">
            <label class="weui-form-preview__label">下单时间</label>
            <span class="weui-form-preview__value">
            	{{ d.data[i].createtime }}
            </span>
        </div>
    </div>
</div>
<br>
{{# } }}
</script>
<script>
	$(function() {
		$(document).on("pageInit", "#page-index", function(e, id, page) {
			var loading = false;
			var pindex = 1;
			function addItems(pindex) {
				$.post("{php echo app_url('store/supervise/get_rush_order',array('status'=>$status,'type'=>$type))}",{pindex:pindex},function(d){
					if (d.data.length > 0) {
						var gettpl1 = document.getElementById('orderlist').innerHTML;
						laytpl(gettpl1).render(d, function(html){
						   $(".allorder").append(html);
						});
					}else if(pindex == 1){
						$(".allorder").html('<div class="common-no-con"><img src="{URL_APP_IMAGE}order_no_con.png" alt=""><p>暂时没有订单哦</p></div>');
					}else{
						$(".weui-loadmore_line").show();
						$(".loading_more").remove();
					}
				}, 'json');
			}
			addItems(pindex);
			$(page).on('infinite', function() {
				if (loading) return;
				loading = true;
				$(".loading_more").show();
				setTimeout(function() {
					loading = false;
					pindex++;
					addItems(pindex);
					$(".loading_more").hide();
					$.refreshScroller();
				}, 1000);
			});
		});
		$(document).on('click','.create-actions', function () {
	      var buttons1 = [
	        {
	          text: '请选择订单类型',
	          label: true
	        },
	        {
	          text: '抢购订单',
	          onClick: function() {
	            location.href="{php echo app_url('store/supervise/order',array('status'=>1))}";
	          }
	        },
	        {
	          text: '卡券订单',
	          onClick: function() {
	            location.href="{php echo app_url('store/supervise/order',array('status'=>1,'type'=>'coupon'))}";
	          }
	        }
	      ];
	      var buttons2 = [
	        {
	          text: '取消',
	          bg: 'danger'
	        }
	      ];
	      var groups = [buttons1, buttons2];
	      $.actions(groups);
	  });
		$.init();
	});
</script>
{php include wl_template('common/footer');}