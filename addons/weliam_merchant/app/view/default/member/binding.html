{php include wl_template('common/header');}
<div class="page-group" >
    <div class="page page-current" id="page-index">
    	<header class="bar bar-nav">
		    <a class="button button-link button-nav pull-left back" href="javascript:history.go(-1);"><span class="icon icon-left"></span>返回</a>
		    <h1 class="title">绑定手机号</h1>
		</header>
		<div class="content native-scroll">
		    <div class="weui-cells weui-cells_form">
	            <div class="weui-cell">
	                <div class="weui-cell__hd"><label class="weui-label">手机号</label></div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="tel" id="loginmobile" placeholder="请输入手机号码" value="{$_W['wlmember']['mobile']}">
	                </div>
	            </div>
	            <div class="weui-cell weui-cell_vcode">
	                <div class="weui-cell__hd">
	                    <label class="weui-label">验证码</label>
	                </div>
	                <div class="weui-cell__bd">
	                    <input class="weui-input" type="tel" id="logincode" placeholder="请输入验证码">
	                </div>
	                <div class="weui-cell__ft">
	                    <a href="javascript:;" class="weui-vcode-btn" id="getVerifyCode">获取验证码</a>
	                </div>
	            </div>
	        </div>
		    <div class="weui-btn-area">
	            <a class="weui-btn weui-btn_primary external" href="javascript:;" id="showTooltips">绑定</a>
	        </div>
		</div>
	</div>	
</div>	
<script type="text/javascript">
$(document).on('click','#showTooltips',function () {
	var mobile = $('#loginmobile').val();
	var inputcode = $('#logincode').val();
	var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
	if(!reg.test(mobile)){
	 	$.toast("请输入正确的手机号");
	 	return false;
	}
	if(!inputcode){
	 	$.toast("请输入验证码");
	 	return false;
	}

	$.post("{php echo app_url('member/user/binding')}",{mobile:mobile,inputcode:inputcode},function(d){
		if(d.result == 1){
			$.alert('绑定成功', function () {
		        location.href = "{$reurl}";
		    });
		}else if(d.result == 2){
			$.toast(d.msg);
		}else{
			$.toast("未知错误");
		}
	},"json");
});

$(document).on('click','#getVerifyCode',function () {
	var mobile = $('#loginmobile').val();
	var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
	if(!reg.test(mobile)){
	 	$.toast("请输入正确的手机号");
	 	return false;
	}

	$.post("{php echo app_url('member/user/vercode')}",{mobile:mobile},function(d){
		if(d.result == 1){
			$.toast("验证码发送成功");
			$('#getVerifyCode').removeClass('verifycode');
			settime();
		}else if(d.result == 2){
			$.toast("验证码发送失败");
		}else{
			$.toast("未知错误");
		}
	},"json");
});

var countdown=60; 
function settime() { 
	if (countdown == 0) { 
		$('#getVerifyCode').html('重新发送');
		$('#getVerifyCode').addClass('verifycode');
		countdown = 60; 
		return;
	} else { 
		$('#getVerifyCode').html("" + countdown + "秒");
		countdown--; 
	} 
	setTimeout(function() { 
		settime() 
	},1000) 
}
</script>
{php include wl_template('common/footer');}